<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="gbk">
    <title>bow</title>
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!--禁止拨打电话-->
    <meta name="format-detection" content="telephone=no" />
    <script>
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            if (parseFloat(RegExp.$1) > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 640;
                document.write('<meta name="viewport" content="width=640, minimum-scale=' + phoneScale + ', maximum-scale=' + phoneScale + ', target-densitydpi=device-dpi" />');
            } else {
                document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi" />');
            }
        } else {
            document.write('<meta name="viewport" content="width=640,user-scalable=no, target-densitydpi=device-dpi" />');
        }
    </script>
    <style>
        /*默认样式*/
        html, body, p, h1, h2, h3, h4, h5, h6, dl, ul, ol, li, dt, dd,figure,figcaption{ margin: 0; padding: 0; font-size:32px; }
        html,body{height: 100%;}
        body {-webkit-tap-highlight-color:rgba(0,0,0,0); background-color:#000;color: #000; font: 32px/1.5 "Microsoft YaHei",Arial; -webkit-text-size-adjust: none; width: 640px; margin: 0 auto}
        ul, ol, li { list-style-type: none; }
        em, i { font-style: normal; }
        a{ color: #000;text-decoration: none; }
        a img { border: 0 none; }
        img{display:block;}
        table { border-collapse:collapse; border-spacing:0; }
        th,td { padding: 0; }
        .clearfix:after { content: ""; display: block; height: 0; overflow: hidden; clear: both; visibility: hidden; }
        @-webkit-keyframes sCir {
            0%{  -webkit-transform: rotate(0deg);  }
            100%{  -webkit-transform: rotate(360deg);  }
        }
        @keyframes sCir {
            0%{  transform: rotate(0deg);  }
            100%{  transform: rotate(360deg);  }
        }
        .sCir{  -webkit-animation: sCir linear 9s infinite;  animation: sCir linear 9s infinite;  }

        @-webkit-keyframes bowLt {
            0%{  -webkit-transform: scaleY(1);  }
            100%{  -webkit-transform: scaleY(0.8);  }
        }
        @keyframes bowLt {
            0%{  transform: scaleY(1);  }
            100%{  transform: scaleY(0.8);  }
        }
        .bowLt{  -webkit-animation: bowLt linear .4s forwards;  animation: bowLt linear .4s forwards;  }

        @-webkit-keyframes arrLt {
            0%{  opacity: 1; -webkit-transform: translate(0px,0px);  }
            100%{  opacity: 0; -webkit-transform: translate(0px,-200px); }
        }
        @keyframes arrLt {
            0%{  opacity: 1;transform: translate(0px,0px);  }
            100%{  opacity: 0;transform: translate(0px,-200px);  }
        }
        .arrLt{  -webkit-animation: arrLt linear .2s forwards;  animation: arrLt linear .2s forwards;  }



        .c{  width: 640px;  height: 100%;  overflow: hidden;  position: relative;  margin: 0 auto;  background: url("http://2.zol-img.com.cn/zt/tm_59e/019b4ed1f7/bg.jpg") no-repeat top center;  background-size: cover;  }
        .time{  width: 100px;  height: 40px;  position: absolute;  top: 0;  left: 0;  text-align: center;  color: #f0ad4e;  font: 28px/40px 'Hiragino sans GB';  }
        .level{  width: 100px;  height: 40px;  position: absolute;  top: 0;  right: 0;  text-align: center;  color: #f0ad4e;  font: 28px/40px 'Hiragino sans GB';  }
        .s{  width: 250px;  height: 250px;  position: absolute;  top: 160px;  left: 195px;   }
        .sun{  width: 250px;  height: 250px;  position: absolute;  top: 0;  left: 0;  z-index: 99;  background: url("http://2.zol-img.com.cn/zt/tm_59e/019b4ed1f7/sun.png") no-repeat 0 0;  }
        .aw{  width: 18px;  height: 260px;  position: absolute;  top: 125px;  left: 116px;  -webkit-transform-origin: top center;  transform-origin: top center;  background: url("http://2.zol-img.com.cn/zt/tm_59e/019b4ed1f7/arrow.png") no-repeat 0 0;  }
        .aw1{  transform: rotate(120deg);  }
        .bow{  width: 240px;  height: 180px;  position: absolute;  bottom: 0;  left: 200px;  -webkit-transform-origin: bottom center;  transform-origin: bottom center;  background: url("http://2.zol-img.com.cn/zt/tm_59e/019b4ed1f7/bow.png") no-repeat 0 0;  }
        .arrow2{  width: 32px;  height: 30px;  position: absolute;  top: 0;  left: 103px;  background: url("http://2.zol-img.com.cn/zt/tm_59e/019b4ed1f7/arrow2.png") no-repeat 0 0;  }
        .rest{  display: none;  width: 600px;  height: 480px;  position: absolute;  top:50%;  left: 50%;  margin: -240px 0 0 -300px;  background: url("http://2.zol-img.com.cn/zt/tm_59e/019b4ed1f7/man.png") no-repeat 0 0;  }



    </style>
</head>
<body>
<div class="c">
    <div class="time"><span id="time">0</span>秒</div>
    <div class="level"><span id="level">2</span>分</div>
    <div class="s sCir">
        <div class="sun"></div>
        <div class="aw aw1"></div>
        <div class="aw aw2"></div>
    </div>
    <div class="bow">
        <div class="arrow2"></div>
    </div>
    <div class="rest"></div>
</div>
<script src="http://icon.zol-img.com.cn/wap/js/z.min.js"></script>
<script charset="gbk">
    var arrows=[360,240];
    var winDeg=0;
    var flag1=1;
    var flag2=0;
    var timeNum=0;
    var levelNum=2;

    /*计时*/
    var tt=setInterval(function(){
        if(flag1==0){
            if(levelNum==36){
                alert('nice shoot~~')
            }else{
                alert('重复射击！游戏结束');
            }
            clearInterval(tt);
            return false;
        }
        timeNum++;
        document.querySelector('#time').innerHTML=timeNum;
    },1000);

    /*箭*/
    function Arrow(deg){
        this.deg=deg;
        this.addArrow= function () {
            var newArrow=document.createElement('div');
            newArrow.style.webkitTransform='rotate(-'+this.deg+'deg)';
            newArrow.className='aw';
            document.querySelector('.s').appendChild(newArrow);
        }
    }

    /*弓*/
    document.querySelector('.bow').addEventListener(Event.Touch.down,function (e) {
        if(flag1==0){
            this.style.pointerEvents='none';
            return false;
        }
        this.classList.add('bowLt');
        document.querySelector('.arrow2').classList.remove('arrLt');
        e.preventDefault();
        e.stopPropagation();
    });
    document.querySelector('.bow').addEventListener(Event.Touch.up,function () {
        s = document.querySelector('.s');
        computedStyle = document.defaultView.getComputedStyle(s, null);
        nowMat=computedStyle.transform+' ';
        //matrix(cosθ,sinθ,-sinθ,cosθ,0,0)
        nowMatArr=nowMat.split('(');
        nowMatArr1=nowMatArr[1].split(',')[0];
        nowMatArr2=nowMatArr[1].split(', ')[1].split(', ')[0];

        nowReg1=Math.acos(nowMatArr1);
        nowReg2=Math.asin(nowMatArr2);
        nowR1=360*nowReg1/(2*Math.PI);
        nowR2=360*nowReg2/(2*Math.PI);

        //console.log(nowReg1);
        //console.log(nowReg2+'_')
        if(nowReg2<0){ nowR1 =360-nowR1}
        nowR1=Math.ceil(nowR1);
        //console.log('originDegree__'+nowR1);
        //console.log(nowR2+'__');

        /*处理下飞行延迟*/
        nowR1+=5;
        if(nowR1>360){
            nowR1-=360;
        }
        /*控制不重复射击*/
        nowR1=Math.floor(nowR1/10)*10;
        console.log('roundDegree__'+nowR1);

        for(var i=0;i<arrows.length;i++){
            if(arrows[i]==nowR1){
                document.querySelector('.s').classList.remove('sCir');
                document.querySelector('.s').style.webkitTransform='rotate('+nowR1+'deg)';
                document.querySelector('.s').style.transform='rotate('+nowR1+'deg)';
                flag2=1;
                flag1=0;
                //return false;
                //return false;
            }
        }
        if(!flag2){
            arrows[arrows.length]=nowR1;
            levelNum++;
            document.querySelector('#level').innerHTML=levelNum;
            if(levelNum==36){
                document.querySelector('.rest').style.display='block';
                document.querySelector('.bow').style.pointerEvents='none';
                flag1=0;
            }
        }


        
        timer&&clearTimeout(timer);
        var timer=setTimeout(function () {
            new Arrow(nowR1).addArrow();
        },10);



        this.classList.remove('bowLt');
        document.querySelector('.arrow2').classList.add('arrLt');
    });






</script>
</body>
</html>