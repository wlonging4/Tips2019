!function(t){var e=function(t,e){this.clientWidth=document.body.clientWidth,this.maxNum=e.maxNum||300,this.minNum=e.minNum||30,this.cellNum=e.cellNum||10,this.totalNum=e.totalNum,this.minNum=parseInt(this.minNum/this.cellNum)*this.cellNum,this.record=[],this.oldMax=e.maxNum,this.oldMin=e.minNum,(this.maxNum-this.minNum)%this.cellNum!=0&&(this.maxNum=this.minNum+this.cellNum*parseInt((this.maxNum-this.minNum)/this.cellNum+1)),this.name=e.name,this.rateName=e.rateName,this.unit=e.unit,this.initNum=e.initNum,this.nowData=this.initNum||this.minNum||30,this.decimalWei=e.decimalWei,this.callback=e.callback,this.callBackStart=e.callBackStart,this.scaleWidth=parseInt(e.scaleWidth)||100,this.scaleWidthDouble=this.scaleWidth/2,this.rulerStructure(t),this.drawBgWhite(),this.drawRuler(),this.moveRuler()};e.prototype.rulerStructure=function(t){var e=document.getElementById(t),i={position:"relative"};this.addStyle(e,i);var a=document.createElement("div");a.setAttribute("class","ruler-title"),titleStyle={width:"100%",height:"35%",position:"relative",overflow:"hidden",top:"-10px"},this.addStyle(a,titleStyle);var l=document.createElement("div");l.setAttribute("class","ruler-parameter"),parameterStyle={width:"215px","text-align":"center","box-sizing":"border-box",margin:"0 auto","margin-top":"30px"},this.addStyle(l,parameterStyle),l.innerHTML="<div id='ruler-num' style='font: bold 0.8rem/50px 微软雅黑; color:#C4A06C; display:inline-block'>30.0</div><div style='font: bold 0.35rem/50px 微软雅黑; color:#999999; display:inline-block;width:0;white-space: pre;'>&nbsp;%</div>",this.numNode=l.firstChild,l.firstChild.innerHTML=this.initNum||this.minNum,a.appendChild(l),e.appendChild(a);var n=document.createElement("div");n.setAttribute("class","ruler-contain"),containStyle={width:"100%",height:"40%",position:"absolute",top:"35%",left:"0%",overflow:"hidden"},this.addStyle(n,containStyle),n.innerHTML="<div class='ruler' id='ruler' style='left: 0; height: 100%; position: absolute; top: 0; left: 0;'><canvas id='rulerCanvas'></canvas></div>",n.firstChild.style.left=-(this.initNum-this.minNum)/this.cellNum*parseInt(this.scaleWidthDouble)+"px",n.firstChild.firstChild.width=2*(Math.ceil((this.maxNum-this.minNum)/this.cellNum)*parseInt(this.scaleWidthDouble)+1*this.clientWidth),n.firstChild.firstChild.height="160",this.canvasObj=n.firstChild.firstChild,this.Canvas=n.firstChild.firstChild.getContext("2d"),this.rulerNode=n.firstChild,e.appendChild(n);var r=document.createElement("div");r.setAttribute("class","ruler-img"),pinStyle={margin:"0 auto",width:"4px",height:"60px",position:"relative","z-index":"9"},this.addStyle(r,pinStyle),r.innerHTML="<canvas id='pinPic' width='4' height='60'></canvas>",this.drawPin(r.firstChild),e.appendChild(r);var s=document.createElement("div");this.valueNode=s,s.setAttribute("class","value-node"),s.innerHTML=this.initNum||this.minNum;var o={"font-size":"26px",color:"#333",position:"absolute",left:"-59%",top:"40%","font-weight":"bold",display:"none"};this.addStyle(s,o),e.appendChild(s);var c=document.createElement("div");c.setAttribute("class","title-node2"),c.innerHTML=this.name+"  ("+this.oldMin+this.unit+"~"+this.oldMax+this.unit+")";var d={"font-size":"0.35rem",color:"#999",position:"absolute",left:"50%",top:"0",transform:"translateX(-50%)","-webkit-transform":"translateX(-50%)","white-space":"pre"};this.addStyle(c,d),e.appendChild(c);var u=document.createElement("div");this.rateNode=u,u.setAttribute("class","value-node value-nodeHtml"),u.innerHTML=(this.totalNum-(this.initNum||this.minNum)).toFixed(2);var h={"font-size":"0.4rem",color:"#C4A06C",display:"inline-block"};this.addStyle(u,h),this.rateNode=document.createElement("div"),this.rateNode.appendChild(u);var m=document.createElement("div");m.setAttribute("class","title-node2"),m.innerHTML=this.rateName+"  "+this.rateNode.innerHTML+"  "+this.unit;var p={"font-size":"0.35rem",color:"#333333",position:"absolute",left:"50%",bottom:"10px",transform:"translateX(-50%)","-webkit-transform":"translateX(-50%)","white-space":"pre"};this.addStyle(m,p),e.appendChild(m),this.rateNode=document.querySelector(".value-nodeHtml")},e.prototype.addStyle=function(t,e){for(var i in e)t.style[i]=e[i]},e.prototype.drawPin=function(t){var e=t.getContext("2d");e.beginPath(),e.moveTo(2.5,10),e.lineTo(2.5,60),e.strokeStyle="#C4A06C",e.lineWidth=3,e.stroke(),e.closePath()},e.prototype.drawBgWhite=function(t){var e=this;e.Canvas.beginPath(),e.Canvas.fillStyle="#FFFFFF",e.Canvas.fillRect(0,0,e.canvasObj.width,e.canvasObj.height),e.Canvas.closePath()},e.prototype.drawRuler=function(){var t=this;!function(){function e(e){t.Canvas.beginPath(),t.Canvas.moveTo(1*t.clientWidth/2+parseInt(t.scaleWidth)/2*e-.5,80),t.Canvas.lineTo(1*t.clientWidth/2+parseInt(t.scaleWidth)/2*e-.5,120),t.Canvas.strokeStyle="#cccccc",t.Canvas.stroke(),t.Canvas.closePath(),t.Canvas.font="26px Arial",t.Canvas.fillStyle="#cccccc",t.Canvas.fillText(t.decimal(Math.floor(t.minNum)+.5*e,t.decimalWei),1*t.clientWidth/2+parseInt(t.scaleWidth)/2*e-16,70)}for(var i=0;i<=Math.ceil((t.maxNum-t.minNum)/(t.cellNum/2));i++)e(i)}(),function(){function e(e){t.Canvas.beginPath(),t.Canvas.moveTo(1*t.clientWidth/2+parseInt(t.scaleWidth)/10*e-.5,100),t.Canvas.lineTo(1*t.clientWidth/2+parseInt(t.scaleWidth)/10*e-.5,120),t.Canvas.strokeStyle="#cccccc",t.Canvas.stroke(),t.Canvas.closePath(),t.Canvas.font="26px Arial",t.Canvas.strokeStyle="#cccccc",t.Canvas.fillStyle="#ccccccc",t.Canvas.fillText(t.decimal(Math.floor(t.minNum)+e/10,t.decimalWei),1*t.clientWidth/2+parseInt(t.scaleWidth)/10*e-16,70)}for(var i=0;i<=100*Math.ceil((t.maxNum-t.minNum)/t.cellNum)/10;i++)i%5!=0&&e(i)}(),function(){var e=100*Math.ceil((t.maxNum-t.minNum)/t.cellNum)/10;t.Canvas.beginPath(),t.Canvas.moveTo(1*t.clientWidth/2-.5,120),t.Canvas.lineTo(1*t.clientWidth/2+parseInt(t.scaleWidth)/10*e-.5,120),t.Canvas.strokeStyle="#dddddd",t.Canvas.stroke(),t.Canvas.closePath()}()},e.prototype.getNowData=function(){return this.nowData},e.prototype.getTotalNum=function(){return this.totalNum},e.prototype.moveRuler=function(){function e(e){function a(e){var e=e||t.event,a=e.targetTouches[0].clientX,l=e.targetTouches[0].clientY,c=a-n,d=l-r;if(isScrolling=Math.abs(c)<Math.abs(d)?1:0,1==isScrolling)e.preventDefault();else{var u=-Math.round(s+c)/(parseInt(i.scaleWidthDouble)/i.cellNum)+i.minNum,h=s+c;h>=0?(h=0,u=i.minNum):h<=-(Math.ceil((i.maxNum-i.minNum)/i.cellNum)*parseInt(i.scaleWidthDouble))&&(h=-(Math.ceil((i.maxNum-i.minNum)/i.cellNum)*parseInt(i.scaleWidthDouble)),u=i.maxNum),i.nowData=i.decimal(u,i.decimalWei),i.numNode.innerHTML=i.nowData,i.valueNode.innerHTML=i.nowData,i.rateNode.innerHTML=parseFloat(i.totalNum-i.nowData).toFixed(2),i.rulerNode.style.left=h+"px",o++;var m=(new Date).getTime();i.record[o]=[],i.record[o].push(m),i.record[o].push(h)}}function l(e){var e=e||t.event;if(i.rulerNode.removeEventListener("touchmove",a),i.rulerNode.removeEventListener("touchend",l),i.record.length>4){var n=(i.record[i.record.length-1][1]-i.record[i.record.length-4][1])/(i.record[i.record.length-1][0]-i.record[i.record.length-4][0])*parseInt(i.scaleWidthDouble)*10;clearInterval(i.timer),i.timer=setInterval(function(){if(Math.abs(n)>i.scaleWidthDouble){n=n>0?n-i.scaleWidthDouble/3:n+i.scaleWidthDouble/3;var t=parseInt(i.rulerNode.style.left)+n/(parseInt(i.scaleWidthDouble)/2);t>=0?t=0:t<=-(Math.ceil((i.maxNum-i.minNum)/i.cellNum)*parseInt(i.scaleWidthDouble))&&(t=-(Math.ceil((i.maxNum-i.minNum)/i.cellNum)*parseInt(i.scaleWidthDouble))),i.rulerNode.style.left=t+"px";var e=-Math.round(t)/(parseInt(i.scaleWidthDouble)/i.cellNum)+i.minNum;i.nowData=i.decimal(e,i.decimalWei),i.numNode.innerHTML=i.nowData,i.valueNode.innerHTML=i.nowData,i.rateNode.innerHTML=(i.totalNum-i.nowData).toFixed(2)}else{clearInterval(i.timer);var a=parseFloat(i.rulerNode.style.left),l=parseInt(a/(parseInt(i.scaleWidthDouble)/10));a-l*(parseInt(i.scaleWidthDouble)/10)>-5?i.movePart(a,l*(parseInt(i.scaleWidthDouble)/10),parseInt(i.scaleWidthDouble)/10,i.rulerNode,"left"):i.movePart(a,(l-1)*(parseInt(i.scaleWidthDouble)/10),parseInt(i.scaleWidthDouble)/10,i.rulerNode,"left")}},10)}else{var r=parseFloat(i.rulerNode.style.left),s=parseInt(r/(parseInt(i.scaleWidthDouble)/10));r-s*(parseInt(i.scaleWidthDouble)/10)>-5?i.movePart(r,s*(parseInt(i.scaleWidthDouble)/10),parseInt(i.scaleWidthDouble)/10,i.rulerNode,"left"):i.movePart(r,(s-1)*(parseInt(i.scaleWidthDouble)/10),parseInt(i.scaleWidthDouble)/10,i.rulerNode,"left");var o=i.callback;"function"==typeof o&&o(i.nowData)}var o=i.callback;setTimeout(function(){o(i.nowData)},500)}i.callBackStart();var e=e||t.event;e.preventDefault(),clearInterval(i.timer),clearInterval(i.partTime),i.record=[];var n=e.targetTouches[0].clientX,r=e.targetTouches[0].clientY;i.rulerNode.addEventListener("touchmove",a,!1);var s=parseInt(i.rulerNode.style.left),o=0;i.rulerNode.addEventListener("touchend",l,!1)}var i=this;this.rulerNode.addEventListener("touchstart",e,!1)},e.prototype.movePart=function(t,e,i,a,l,n){var r=this,s=-parseInt(r.scaleWidthDouble)*(r.oldMax-r.minNum)/r.cellNum,o=-parseInt(r.scaleWidthDouble)*(r.oldMin-r.minNum)/r.cellNum,e=s>e?s:e;e=e>o?o:e;var n=r.callback;if(clearInterval(this.partTime),e!=t){var c=(e-t)/i;this.partTime=setInterval(function(){t+=c,e>=t&&0>c?(clearInterval(r.partTime),t=e,"function"==typeof n&&n(r.nowData)):t>=e&&c>0&&(clearInterval(r.partTime),t=e,"function"==typeof n&&n(r.nowData)),a.style[l]=t+"px";var i=-Math.round(t)/(parseInt(r.scaleWidthDouble)/r.cellNum)+r.minNum;r.nowData=r.decimal(i,r.decimalWei),r.numNode.innerHTML=r.nowData,r.valueNode.innerHTML=r.nowData,r.rateNode.innerHTML=(r.totalNum-r.nowData).toFixed(2)},20)}},e.prototype.decimal=function(t,e){var i=t.toString().split(".");if(1==e){if(1==i.length)return t=t.toString()+".0";if(i.length>1){if("0"==i[1].substring(0,e))return t=Math.round(t).toString()+".0";t=Math.round(10*t)/10;var a=t.toString().split(".");return 1==a.length&&(t+=".0"),t}}else{if(2!=e)return Math.round(t);if(1==i.length)return t=t.toString()+".00";if(i.length>1){if("0"==i[1].substring(0,e))return t=Math.round(t).toString()+".00";t=Math.round(t*parseInt(that.scaleWidthDouble))/parseInt(that.scaleWidthDouble);var a=t.toString().split(".");return 1==a.length&&(t+=".00"),t}}},"object"==typeof module&&module&&"object"==typeof module.exports&&(module.exports=e),t.Ruler=e}(window);