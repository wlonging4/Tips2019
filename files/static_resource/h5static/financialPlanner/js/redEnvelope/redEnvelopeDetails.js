appSmallBellBtn(),Tips.init(),Loading.init();var redEnvelopeDetails={types:"",redPacketStoreId:getQueryString("redPacketStoreId")?getQueryString("redPacketStoreId"):"",repeatTimeId:getQueryString("repeatTimeId")?getQueryString("repeatTimeId"):"",redPacketTemplateId:"",init:function(e,t){this.types="sent",this.types=getQueryString("type")?getQueryString("type"):"sent",this.types="grab"==this.types?"grab":"sent",this.detailBox=e,this.bottomBoxObj=t;var a=this,n=a.redPacketStoreId,o=a.repeatTimeId,i=JSON.stringify({redPacketStoreId:n,repeatTimeId:o});xhReqDataHandleFn(i,redEnvelopeDetails,"loadData")},loadData:function(e){var t=this;"grab"==this.types?t.ajaxUrl="/webapi/capp/redpacket/store/getGrabDetail.ason":"sent"==this.types&&(t.ajaxUrl="/webapi/capp/redpacket/store/get.ason"),e={data:e},$.ajax({url:t.ajaxUrl,type:"POST",async:!0,cache:!1,dataType:"JSON",data:e,success:function(e){"1"==e.code?(t.redPacketTemplateId=e.data.redPacketTemplateId,redEnvelopeDetails.detailsHtml(e.data),t.successDialogCreateFn()):"5001"==e.code&&appToLogin()},error:function(e){}})},grabSubmit:function(){var e=this,t=(e.redPacketStoreId,e.repeatTimeId),a=JSON.stringify({repeatId:t});xhReqDataHandleFn(a,redEnvelopeDetails,"submitFn")},submitFn:function(e){e={data:e};var t="/webapi/capp/redpacket/store/grab.ason";Loading.show(),$.ajax({url:t,type:"POST",async:!0,cache:!1,dataType:"JSON",data:e,success:function(e){if(Loading.hide(),"1"==e.code){var t="恭喜成功抢到"+e.data.count+"个满减券";successDialog.setContent(t),successDialog.open()}else"605001"==e.code?erroDialog.open():"605004"==e.code?Tips.show("请重新尝试"):"5001"==e.code?appToLogin():Tips.show(e.msg)},error:function(e){Loading.hide()}})},loadDetails:function(){},btnWord:{sentStatus1:{btnTxt:"立即发放",onclickFn:"appToSendRed()"},sentStatus2:{btnTxt:"已过期",onclickFn:""},grabStatus1:{btnTxt:"立即抢",onclickFn:"redEnvelopeDetails.grabSubmit()"},grabStatus3:{btnTxt:"已抢",onclickFn:""},grabStatus4:{btnTxt:"抢光了",onclickFn:""},grabStatus5:{btnTxt:"距离开抢",onclickFn:""}},dataProcess:function(e){var t=e,a="",n=!1;if("grab"==this.types)a=this.types+"Status"+e.grabStatus,(3==e.grabStatus||4==e.grabStatus)&&(n=!0,t.canGetCount=0);else if("sent"==this.types){a=this.types+"Status"+e.status;var o=parseInt(e.redCount)-parseInt(e.putCount);this.remainingNum=o,t.remainingNum=o,n=2==e.status||0>=o}return t.types=this.types,t.btnWord=this.btnWord[a].btnTxt,t.onclickFn=this.btnWord[a].onclickFn,"appToSendRed()"==t.onclickFn&&(t.onclickFn="appToSendRed('"+this.redPacketStoreId+"','"+this.redPacketTemplateId+"','"+this.remainingNum+"')"),t.fullCutAmount=0==e.fullCutAmount||null==e.fullCutAmount?"不限金额":"满"+t.fullCutAmount+"元可用",t.btnClass=n?"disabled":"",5==e.grabStatus&&"grab"==this.types&&(t.btnWord=this.btnWord[a].btnTxt+"&emsp;<span class='js_timingStr'>"+this.strToSeconds(e.countdown)+"</span>",this.countdown=e.countdown,setInterval(function(){redEnvelopeDetails.countdown=parseInt(redEnvelopeDetails.countdown)-1;var e=redEnvelopeDetails.strToSeconds(redEnvelopeDetails.countdown);e.indexOf("-")>-1&&(e="",redEnvelopeDetails.dataTimeNowChange(e),document.querySelector(".btnBox a").innerHTML="立即抢",document.querySelector(".btnBox").addEventListener("click",function(){redEnvelopeDetails.grabSubmit()})),redEnvelopeDetails.dataTimeNowChange(e)},1e3)),t},detailsHtml:function(e){e=this.dataProcess(e),e.productNames&&(e.productNames=e.productNames.replace(/,/g,"、")),this.detailBox.innerHTML=tmpl("detailTop",{item:e}),this.bottomBoxObj.innerHTML="noBtn"!=getQueryString("btnState")?tmpl("detailBottom",{item:e}):tmpl("detailBottomHideBtn",{item:e})},dataTimeNowChange:function(e){document.querySelector(".js_timingStr").innerHTML=e},phoneEndTime:null,strToSeconds:function(e){if(!redEnvelopeDetails.phoneEndTime){e=parseInt(e);var t=new Date,a=t.getTime()+1e3*e;this.phoneEndTime=a}var n=redEnvelopeDetails.dataTimeNow(redEnvelopeDetails.phoneEndTime);return n},dataTimeNow:function(e){var t=new Date,a=new Date(e),n=a.getTime()-t.getTime(),o=Math.floor(n/864e5),i=n%864e5,r=Math.floor(i/36e5),s=i%36e5,d=Math.floor(s/6e4),l=s%6e4,c=Math.round(l/1e3);60==d&&(r+=1,d=0),60==c&&(d+=1,c=0),d=10>d?"0"+d:d,c=10>c?"0"+c:c,r=24*o+r,r=10>r?"0"+r:r;var p=r+":"+d+":"+c;return p},dataTimeNow1:function(e){e=e.replace(/-/g,"/");var t=new Date(e),a=new Date,n=parseInt((t-a)/1e3),o=Math.floor(n/86400),i=n%86400,r=Math.floor(i/3600);i%=3600;var s=Math.floor(i/60),d=i%60,l="还剩:"+o+"天"+r+"小时"+s+"分钟"+d+"秒";return l},appTitleArr:{grab:"抢满减券",sent:"发满减券",hasSent:"已发满减券"},successDialogCreateFn:function(){var e=this;successDialog=new Dialog({contentText:"恭喜成功抢到10个满减券",isPromptbtn:!0,conisPromptText:["去发满减券","继续抢满减券"],conisPromptClick:["appToSendRed('"+e.redPacketStoreId+"','"+e.redPacketTemplateId+"','"+e.remainingNum+"')","appToGrabRedEnvelope()"],callback:function(){}})}},successDialog,erroDialog;window.onload=function(){var e=document.querySelector(".js_detail"),t=document.querySelector(".js_mainBottom");redEnvelopeDetails.init(e,t),erroDialog=new Dialog({contentText:"很遗憾，您没有抢到满减券",isPromptbtn:!0,conisPromptText:["知道了"],conisPromptClick:["appToGrabRedEnvelope()"],callback:function(){}});var a;a="noBtn"!=getQueryString("btnState")?redEnvelopeDetails.appTitleArr[redEnvelopeDetails.types]:redEnvelopeDetails.appTitleArr.hasSent,appSetWebTitle(a)};