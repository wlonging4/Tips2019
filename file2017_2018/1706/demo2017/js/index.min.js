/**
 * Created by Moker on 2017/6/27.
 */
$(function () {
    index.load()
});
var index = new function () {
    this.nowTime, this.lastTime, this.offsetTime, this.indexAnimationTime = 7, this.success = 0, this.tt
};
index.load = function () {
    main.init(), main.lines(), main.initIndexData(), main.skyBox(), main.cameraInit(), main.cameraAllow = !1, this.loadImages(), this.start(), this._time = [], $(".line_text1").addClass("index_text_1"), $(".line_text2").addClass("index_text_2"), $(".line_text3").addClass("index_text_3"), this.tt = setTimeout(function () {
        $(".line_text1").addClass("index_text_1"), $(".line_text2").addClass("index_text_2"), $(".line_text3").addClass("index_text_3")
    }, 9200)
}, index.init = function () {
    $("#total").show(), setTimeout(function () {
        index.indexAnimation();
        var a = main.getPiece("38");
        a.alpha = 0, a.updateV()
    }, 6e3), requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function (a) {
            setTimeout(a, 1e3 / 60)
        }, requestAnimationFrame(loop = function () {
        index.setPX(), main.animationDomWork(), main.animationWork(), main.cameraUpdate(), requestAnimationFrame(loop)
    })
}, index.indexAnimation = function () {
    setTimeout(function () {
        var a, b, c, d;
        for (a = 1; 3 >= a; a++)$(".line_text" + a).removeClass("lt_fadeIn_2").hide();
        for (index.t($(".index_5"), 500, "move_to_left"), index.t($(".index_6"), 500, "move_to_right"), b = 0, c = [12, 10, 13, 7], d = [9, 8, 11, 14], a = 0; a < c.length; a++)b++, index.t($(".index_" + c[a]), 500, "boom_" + b);
        for (a = 0; a < d.length; a++)b++, index.t($(".index_" + d[a]), 500, "boom_" + b);
        index.t($(".index_1"), 500, "move_to_up"), index.t($(".index_3"), 500, "move_to_down"), index.t($(".index_4"), 500, "move_to_down"), index.t($(".line_text_bg"), 500, "music_f7_animation"), setTimeout(function () {
            index.animation()
        }, 1300)
    }, 100)
}, index.animation = function () {
    index.t($(".index_2"), 0, "index_min"), main.addAnimation(main.box, 0, 40, {x: 0, y: 0, z: 0}, {
        x: 1,
        y: 1,
        z: 1
    }, 10, "scale", "linear"), main.addAnimation(main.box, 0, 120, {x: 0, y: -550, z: -2e3}, {
        x: 0,
        y: 0,
        z: 0
    }, 40, "position", "easeOut"), main.addAnimation(main.box, 0, 150, {x: 0, y: -480, z: 0}, {
        x: 0,
        y: main.alpha,
        z: 0
    }, 10, "rotation", "easeOut", 0, function () {
        var b, c, a = ["38", "touch_TS", "music_TS", "car_TS", "video_TS"];
        for (b = 0; b < a.length; b++)c = main.getPiece(a[b]), "38" == a[b] ? main.addAnimation(c, 0, 100, {
                x: c.x,
                y: c.y,
                z: c.z
            }, {x: c.x, y: c.y + 100, z: c.z}, 0, "position", "easeIn", 9999) : main.addAnimation(c, 0, 50, {
                x: c.x,
                y: c.y,
                z: c.z
            }, {x: c.x, y: c.y - 20, z: c.z}, 0, "position", "easeOut", 9999);
        main.cameraAllow = !0, $("#index").hide(), $("#ts").show().addClass("obj_fadeIn_speed").bind("touchstart", function () {
            $("#ts").unbind("touchstart").css("opacity", 1).removeClass("obj_fadeIn_speed").addClass("obj_fadeOut"), setTimeout(function () {
                $("#ts").hide()
            }, 500)
        })
    })
}, index.loadImages = function () {
    var a, b;
    for (this.textures = 55, this.images = ["images/bg.jpg", "images/car_TS.png", "images/empty.png", "images/index_1.png", "images/index_2.png", "images/index_3.png", "images/index_4.png", "images/index_5.png", "images/index_6.png", "images/index_7.png", "images/index_8.png", "images/index_9.png", "images/index_10.png", "images/index_11.png", "images/index_12.png", "images/index_13.png", "images/line_text1.png", "images/line_text2.png", "images/line_text3.png", "images/music.png", "images/music_TS.png", "images/touch_phone.png", "images/touch_TS.png", "textures/text1.png", "textures/text2.png", "textures/text3.png", "textures/text4.png", "textures/text1-1.png", "textures/text2-1.png", "textures/text3-1.png", "textures/text4-1.png", "images/video.png", "images/video_TS.png"], this.now = 0, this.total = this.textures + this.images.length - 1, a = 1; a <= this.textures; a++)b = new Image, b.src = "textures/" + a + ".png", b.onload = function () {
        index.loadWork()
    };
    for (a = 0; a < this.images.length; a++)b = new Image, b.src = this.images[a], b.onload = function () {
        index.loadWork()
    }
}, index.loadWork = function () {
    ++this.now == this.total && (clearTimeout(this.tt), setTimeout(function () {
        index.init()
    }, 500))
}, index.start = function () {
    var a, b;
    for (main.addObject(["images/touch_TS.png"], 62, -5, !1, !1, !1, !1, !1, "touch_TS"), main.addObject(["images/touch_phone.png"], 62, -15, !0, !1, !1, !1, function () {
        this.x >= 385 && this.y >= 180 && (index.music(4), index.tsHide("touch_TS"), main.activeObject = !1, main.setIndexAnimation("one"), main.addAnimation(main.getPiece("text1"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {x: 1, y: 1, z: 1}, 30, "scale", "easeInOutExpo"), main.addAnimation(main.getPiece("text1-1"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {
            x: 1.2,
            y: 1.2,
            z: 1.2
        }, 200, "scale", "easeInOutExpo"), $(this.el).addClass("obj_fadeOut"), $(this.el).unbind("touchmove").unbind("touchstart").unbind("touchend"), index.qq())
    }), a = 0; 5 > a; a++)main.addObject(["images/music.png"], 135, -60, !1, !1, !1, !0, !1, "music" + a);
    for (main.addObject(["images/music_TS.png"], 135, -70, !1, !1, !1, !1, !1, "music_TS"), main.addObject(["images/empty.png"], 135, -45, !1, !1, !0, !1, function () {
        var a, b, c;
        for (index.music(2), index.tsHide("music_TS"), index.qq(), main.setIndexAnimation("two"), main.addAnimation(main.getPiece("text2"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {x: 1, y: 1, z: 1}, 30, "scale", "easeInOutExpo"), main.addAnimation(main.getPiece("text2-1"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {
            x: 1.2,
            y: 1.2,
            z: 1.2
        }, 200, "scale", "easeInOutExpo"), this.clickAllow = !1, a = 0; 5 > a; a++)b = main.getPiece("music" + a), c = 10 + 30 * a, main.addAnimation(b, 0, 60, {
            x: b.rotationX,
            y: b.rotationY,
            z: b.rotationZ
        }, {
            x: b.rotationX,
            y: b.rotationY,
            z: b.rotationZ + main.rand(360, 480)
        }, c, "rotation", "linear"), main.addAnimation(b, 0, 60, {x: b.x, y: b.y, z: b.z}, {
            x: b.x - 100,
            y: b.y - 200,
            z: b.z
        }, c, "position", "linear"), main.addAnimation(b, 0, 30, {x: 0, y: 0, z: 0}, {
            x: 1,
            y: 1,
            z: 1
        }, c, "scale", "linear", 0, function () {
            $(this.object.el).addClass("obj_fadeOut")
        })
    }), main.addObject(["images/car_TS.png"], 210, -35, !1, !1, !1, !1, !1, "car_TS"), main.addObject(["images/empty.png"], 210, -20, !1, !1, !0, !1, function () {
        index.music(3), index.tsHide("car_TS"), main.setIndexAnimation("three"), main.addAnimation(main.getPiece("text3"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {x: 1, y: 1, z: 1}, 30, "scale", "easeInOutExpo"), main.addAnimation(main.getPiece("text3-1"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {x: 1.2, y: 1.2, z: 1.2}, 200, "scale", "easeInOutExpo"), this.clickAllow = !1, index.qq()
    }), main.addObject(["images/video_TS.png"], 270, 10, !1, !1, !1, !1, !1, "video_TS"), main.addObject(["images/video_TAR.png"], 270, -12, !1, !1, !1, !1, !1, "video_TAR"), main.addObject(["images/video.png"], 270, -5, !1, !0, !1, !1, function () {
        var b, c, a = main.alpha % 360;
        0 > a && (a = 360 - Math.abs(a)), b = this.ALPHA - a, b > -20 && 20 > b && Math.abs(this.ALPHA - 275) < 8 && main.cameraAllow && (index.music(5), index.qq(), $(main.getPiece("video_TS").el).addClass("obj_fadeOut"), main.setIndexAnimation("four"), main.addAnimation(main.getPiece("text4"), 0, 60, {
            x: 0,
            y: 0,
            z: 0
        }, {
            x: 1,
            y: 1,
            z: 1
        }, 30, "scale", "easeInOutExpo"), this.orienterAllow = !1, c = main.getPiece("video_TAR"), main.addAnimation(this, 0, 50, {
            x: this.x,
            y: this.y,
            z: this.z
        }, {x: c.x, y: c.y, z: c.z}, 0, "position", "linear", 0, function () {
            $(main.getPiece("video_TAR").el).addClass("obj_fadeOut")
        }))
    }), main.addObject(["images/empty.png"], 330, -10, !1, !1, !0, !1, function () {
        index.success >= 2 && (window.location.href = "http://weibo.com/p/100808d5de00586c6c9f127df829ca7baf40c9?k=%E6%88%91%E4%BB%ACi%E9%9F%B3%E4%B9%90&from=501&_from_=huati_topic")
    }), b = [{alpha: -10, beta: 25, url: 21}, {alpha: 40, beta: 90, url: 22}, {
        alpha: 70,
        beta: 90,
        url: 23
    }, {alpha: 105, beta: 90, url: 24}, {alpha: 92, beta: 15, url: 25}, {alpha: 132, beta: 11, url: 26}, {
        alpha: 180,
        beta: -90,
        url: 27
    }, {alpha: 180, beta: 60, url: 28}, {alpha: 232, beta: 6, url: 29}, {
        alpha: 230,
        beta: 74,
        url: 30,
        type: 1
    }, {alpha: 260, beta: 90, url: 31}, {alpha: 250, beta: 10, url: 32}, {alpha: 240, beta: -90, url: 33}, {
        alpha: 280,
        beta: 90,
        url: 34
    }, {alpha: 300, beta: 50, url: 35}, {alpha: 320, beta: 70, url: 36}, {alpha: 310, beta: -90, url: 37}, {
        alpha: 330,
        beta: -10,
        url: 38
    }, {alpha: 80, beta: 45, url: 39}, {alpha: -5, beta: -20, url: 40}, {
        alpha: 135,
        beta: -40,
        url: 41,
        type: 1
    }, {alpha: 135, beta: -40, url: 42, type: 2}, {alpha: 210, beta: -40, url: 43, type: 1}, {
        alpha: 210,
        beta: -40,
        url: 44,
        type: 2
    }, {alpha: 261, beta: 40, url: 45, type: 1}, {alpha: 261, beta: 40, url: 46, type: 2}, {
        alpha: 230,
        beta: 74,
        url: 47,
        type: 2
    }, {alpha: 125, beta: 59, url: 48, type: 1}, {alpha: 125, beta: 59, url: 49, type: 2}, {
        alpha: 20,
        beta: 0,
        url: 50,
        type: 1
    }, {alpha: 20, beta: 0, url: 51, type: 2}, {alpha: 67, beta: -45, url: 52, type: 1}, {
        alpha: 67,
        beta: -45,
        url: 53,
        type: 2
    }, {alpha: 287, beta: -42, url: 54, type: 1}, {alpha: 287, beta: -42, url: 55, type: 2}, {
        alpha: 55,
        beta: 5,
        url: "text1"
    }, {alpha: 155, beta: -30, url: "text2"}, {alpha: 205, beta: 0, url: "text3"}, {
        alpha: 290,
        beta: 10,
        url: "text4"
    }, {alpha: 55, beta: 0, url: "text1-1", text: !0}, {alpha: 155, beta: -35, url: "text2-1", text: !0}, {
        alpha: 205,
        beta: -5,
        url: "text3-1",
        text: !0
    }, {
        alpha: 290,
        beta: 5,
        url: "text4-1",
        text: !0
    }], a = 0; a < b.length; a++)b[a].type ? 1 == b[a].type ? main.addObject(["textures/" + b[a].url + ".png"], b[a].alpha, b[a].beta, !1, !1, !1, !1, !1, "star" + b[a].url, !0, !1) : main.addObject(["textures/" + b[a].url + ".png"], b[a].alpha, b[a].beta, !1, !1, !1, !1, !1, "star" + b[a].url, !0, !0) : "number" == typeof b[a].url ? main.addObject(["textures/" + b[a].url + ".png"], b[a].alpha, b[a].beta, !1, !1, !1, !1, !1, b[a].url) : b[a].text ? main.addObject(["textures/" + b[a].url + ".png"], b[a].alpha, b[a].beta, !1, !1, !1, !0, !1, b[a].url, !1, !1, !0) : main.addObject(["textures/" + b[a].url + ".png"], b[a].alpha, b[a].beta, !1, !1, !1, !0, !1, b[a].url)
}, index.setPX = function () {
    this.now ? (main.animationPX = 1, this.nowTime = main.now(), this.offsetTime = this.nowTime - this.lastTime, this.offsetTime > 40 && this.offsetTime < 100 ? (main.animationPX = 5, main.cameraSpeed = .4, main.cameraBack = 4) : this.offsetTime >= 100 && this.offsetTime < 200 ? (main.animationPX = 8, main.cameraSpeed = .5, main.cameraBack = 8) : this.offsetTime >= 200 && (main.animationPX = 8, main.cameraSpeed = .5, main.cameraBack = 8, this.indexAnimationTime = 10), this.lastTime = this.nowTime) : this.lastTime = main.now()
}, index.music = function (a) {
    var b, c;
    for (b = 1; 6 > b; b++)c = document.getElementById("music" + b), c.currentTime = 0, b == a ? c.play() : c.pause()
}, index.tsHide = function (a) {
    var b = main.getPiece(a);
    b.noAnimation = !0, $(b.el).addClass("obj_fadeOut")
}, index.browser = function () {
    var a = {
        versions: function () {
            var a = navigator.userAgent;
            return navigator.appVersion, {
                ios: !!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
                android: a.indexOf("Android") > -1 || a.indexOf("Linux") > -1,
                iPhone: a.indexOf("iPhone") > -1,
                iPad: a.indexOf("iPad") > -1
            }
        }()
    };
    return a.versions.iPhone || a.versions.iPad || a.versions.ios ? 1 : a.versions.android ? 0 : void 0
}, index.t = function (a, b, c) {
    setTimeout(function () {
        a.addClass(c)
    }, b)
}, index.g = function (a) {
    return document.getElementById(a)
}, index.qq = function () {
    if (2 == ++this.success) {
        var a = main.getPiece("38");
        a.alpha = 1, a.updateV()
    }
};